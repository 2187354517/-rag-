# -rag-
项目概述
![image](https://github.com/user-attachments/assets/3ef2f89a-a67b-410c-bdda-e11a65e578de)
技术框架
![image](https://github.com/user-attachments/assets/024ddfd7-f32d-43c1-a168-6b029dc0e60b)
![image](https://github.com/user-attachments/assets/e24ed4da-50c2-404f-a1be-ffad40dae2d1)

优势
![image](https://github.com/user-attachments/assets/b5bef2a0-c74d-496a-b517-ae490b0ae567)
解决
![image](https://github.com/user-attachments/assets/b72bcfea-5b94-40a9-9218-627a393a1e4d)
![image](https://github.com/user-attachments/assets/dcef5823-d358-4fc4-b60f-e3ce237a5351)
![image](https://github.com/user-attachments/assets/e05c1706-6eb7-484a-abfe-87ada66ee4d5)
![image](https://github.com/user-attachments/assets/39ed1a40-96ba-4952-8a7c-b0ac315d52f7)
![image](https://github.com/user-attachments/assets/f8c2cb0e-018f-436b-8a60-5ae27e217a45)
技术架构
![image](https://github.com/user-attachments/assets/bbbb182a-d4b6-4576-bda9-4950be77083a)
➢向量检索：使用HuggingFace的sentence-transformers模型生成文本嵌入，存储于Chroma向量数据库中，支持语义相似度检索。
➢关键词检索：基于BM25算法，对文档词频和逆文档频率进行加权，精准匹配数学术语和公式。
➢重排序：通过交叉编码器（CrossEncoder）对检索结果进行相关性评分，筛选得分高于阈值（0.85）的文档，并按分数排序返回。
2.核心流程：
➢检索阶段：用户输入问题后，系统并行执行向量检索和BM25检索，分别返回Top-5相关文档。
➢融合阶段：根据权重（向量检索60%，BM25 40%）合并结果，去除重复文档。
➢生成阶段：将检索结果注入大模型提示词模板，生成包含解题步骤的答案。
(二)流式输出模块实现
1.技术方案：
➢流式生成：基于Llama.cpp的create_completion接口，启用stream=True参数，实现逐Token返回。
➢缓冲区管理：动态聚合3个Token或随机概率（20%）触发Flush，平衡流畅性与实时性。
➢异常处理：捕获生成中断信号，返回友好错误提示（如“服务响应异常，请重试”）。
2.性能优化：
➢显存控制：通过GGML_CUDA_MAX_DEVICE_BUF限制显存占用，避免溢出。
➢线程配置：设置OMP_NUM_THREADS=10，充分利用多核CPU资源。
(三)MarkDown渲染的实现
1.技术栈：
➢解析器：使用markdown-it库解析Markdown语法，支持GFM（GitHub Flavored Markdown）扩展。
➢高亮：集成highlight.js，自动识别代码语言并着色。
➢安全净化：通过DOMPurify过滤XSS风险，保留数学公式标签。
2.功能增强：
➢懒加载图片：通过IntersectionObserver监听图片进入视口时加载，初始显示占位背景。
➢表格适配：强制overflow-x: auto，确保宽表格可横向滚动。
➢Katex支持：通过markdown-it-katex插件渲染LaTeX公式。
(四)相关问题模块实现
1.生成逻辑:
➢提示词工程：要求模型生成5个无编号、长度≤30字的问题。
➢后处理：通过正则表达式清理编号前缀（如1.、Q2:），保底按换行符分割。
2.数学问题适配:
➢分类模型：调用SeqGPT模型判断是否为数学问题，若否则追加关键词匹配（如“导数”“积分”）。
➢结果过滤：移除不含问号的非数学问题，确保推荐质量。
(五)相关资料模块实现
1.检索流程：
➢编码查询：用多语言模型（paraphrase-multilingual-MiniLM-L12-v2）生成查询向量。
➢相似度计算：对知识库文档前512字符编码，计算余弦相似度，返回Top-3结果。
➢结果格式化：包含文件名、路径、相似度（如"similarity": 0.92）和来源标记。
2.缓存机制：
➢本地缓存：将搜索结果以JSON格式存储于search_cache目录，有效期24小时。
➢增量更新：仅对新文档或修改过的文档重新计算嵌入。
需求概要
![image](https://github.com/user-attachments/assets/ffd9bf78-3d99-44c9-8260-f1899a641d26)
1.登录注册功能：
(1)登录：已注册的用户可以使用此功能登录平台。登录方式为输入注册时使用的用户名和对应的密码。
(2)注册：用户可以通过此功能创建新的账户。注册流程通常包括输入有效的邮箱地址，设置符合要求的密码（密码长度至少需要8位），设置符合要求的用户名（用户名由3-12位的数字或字母组合）。完成注册后，用户将拥有一个专属的账户，用于登录 PolarSolve 平台。
2.API 密钥管理功能：
(1)密钥生成和复制：用户可以通过此功能生成新的 API 密钥，用于访问 PolarSolve 平台提供的 API 服务。生成的密钥可以是系统自动生成的一串随机字符，具有一定的长度和复杂度。同时，用户可以方便地复制生成的密钥，以便在需要调用 API 的外部应用或系统中使用。
(2)密钥删除：当用户不再需要某个 API 密钥，或者认为该密钥存在安全风险时，可以使用此功能删除对应的 API 密钥。删除操作通常需要用户进行二次确认，以防止误删。一旦密钥被删除，与之关联的 API 访问权限将立即失效。
3.帮助使用手册功能
(1)概述：提供对 PolarSolve 平台一系列 API 接口使用的说明文档。
(2)功能详解： 用户可以根据使用手册正确使用API接口。
4.个人知识库管理功能：
(1)创建个人知识库：用户可以使用此功能创建自己的知识库，用于存储和管理个人的知识内容。知识库的内容可以包括文本笔记、上传的文档（如 PDF、JSON 文件等）等多种形式，方便用户整理和保存各种类型的知识资料。
(2)删除个人知识库：当用户不再需要某个知识库，或者知识库中的内容已经过时、无用时，可以使用此功能删除对应的知识库。删除操作需要用户进行确认，以避免误删重要信息。删除后，该知识库及其包含的所有内容将从系统中永久删除。
(3)修改个人知识库：用户可以对已创建的个人知识库进行修改操作，例如编辑知识库的名称、更新知识库中的内容等。修改功能允许用户根据实际需求不断完善和调整自己的知识库，使其更加符合个人的使用习惯和需求。
(4)查看个人知识库：用户可以通过此功能查看自己创建的知识库内容。
5.智能聊天功能：
(1)问题输出：用户通过输入框发送问题
(2)RAG 检索分步回答：利用检索增强生成（RAG）技术，先从相关的知识库或数据源中检索与问题相关的信息，然后将这些信息整合并以分步的方式进行回答。这种方式可以确保回答的准确性和全面性，同时对于复杂问题，分步回答能够帮助用户更好地理解问题的解决思路和过程。
(3)多轮对话：支持用户与系统进行多轮对话。当用户对回答不满意或有进一步的疑问时，可以继续提问，系统会根据上下文理解用户的追问意图，并提供相应的回答。通过多轮对话，用户可以与系统进行更深入的交流，直到问题得到彻底解决。
(4)停止本轮对话：用户可以随时使用停止按钮停止当前的对话。停止后，用户可以继续进行下一个问题的输出，或者对之前的对话内容进行回顾和管理。
6.会话管理功能：
(1)新建会话：在用户可以通过此功能创建新的会话。
(2)删除会话：当用户认为某个会话不再有用或希望清理历史记录时，可以使用此功能删除对应的会话。删除后，该会话及其包含的所有聊天记录将从系统中删除。
(3)编辑会话名称：用户可以对已有的会话名称进行编辑修改。通过自定义会话名称，用户可以更方便地识别和查找特定的会话，提高会话管理的效率。例如，将会话名称改为与讨论主题相关的内容，便于快速定位和回顾。
7.相关问题推荐功能：
(1)匹配机制：根据用户输入的问题，利用大模型生成与之相关的问题列表。在处理过程中，会先验证用户提供的 API 密钥，确保请求的合法性，然后调用检索增强生成（RAG）技术来生成相关问题。若过程中出现异常，会记录错误日志并返回相应的错误信息。
(2)列表展示：将匹配到的相关问题以列表的形式展示给用户。用户可以通过浏览列表，快速找到自己感兴趣的相关问题，点击发送问题。
8.相关资料推荐功能：
(1)知识库检索：系统会对知识库目录下的文件进行遍历。若用户提供了查询内容，系统会使用 sentence_model 对查询文本和文件内容（取前 512 个字符）进行编码，然后计算它们之间的余弦相似度。系统会根据计算得到的相似度对知识库中的文件进行排序，并只返回前三个最相关的文件。
(2)文档展示：将匹配到的相关文档展示给用户。用户可以通过浏览文档，快速找到自己感兴趣的相关资料。
概念模型
![image](https://github.com/user-attachments/assets/0156a486-8280-4446-bbfe-3e2f74660078)

